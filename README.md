# Умная кормушка для рыб
## Описание
Данный репозиторий содержит файлы для создания сервера умной кормушки для рыб и файлы для прошивки arduino. Сервер включает себя API и Telegram бота. 

## Сервер
Файлы сервера включают в себя 3 основных модуля:
DB - база данных на SQLite которая формируется в файле aquamonitor.db
API - обработка основных запросов от устройства
TelegramBot - связь с ботом и обработка сообщений от него
Для функционирования сервера требуется добавить файл token.txt в папку TelegramBot, в котором будет находиться строка с токеном для доступа к боту.

Для запуска сервера требуется запустить файл main.py в корневой папке.
### Основные команды бота
/register <имя устройства> <уникальный идентификатор устройства> - добавляет устройство в базу данных
/configure <имя устройства> <интервал кормления в часах> - меняет конфигурацию устройства
/get_data_from_device - возвращает значение с выбранного устройства
/get_data_from_all_devices - возвращает значение со всех устройств
/update_data_on_device - отправляет запрос на устройство на обновление данных
/update_data_on_all_devices - отправляет запрос на все устройства на обновление данных

## Устройство
Устройство состоит из микроконтроллера Arduino UNO, ESP8266 WIFI модуля, связанный с микроконтроллером при помощи SoftSerial, датчиков мутности и уровня воды а также щёточного мотора, подключенного при помощи реле.
Подключение компонентов показано на схеме:![image](https://github.com/user-attachments/assets/ceb2cb8a-6e76-483c-aabc-e28106bcf018)


ESP8266: 

RX - 9 pin

TX - 8 pin

G - GND

3.3V - 3.3V


Датчик мутности:

G - GND

A - A0

V - 5V

Датчик уровня воды:

"-" - GND

S - A5

"+" - 5V


Реле:

VCC - 5V

GND - GND

IN - 12 pin

NO - 5V


## Прошивка

Микроконтроллер считывает значения датчиков а также отвечает за управление мотором. Получая сигналы при помощи UART он отправляет значения ESP или запускает мотор. В том сулче, если значения датчиков достигают критических значений, микрокотнтроллер отправляет сигнал ESP.
ESP создаёт точку доступа, при подключении к которой пользователь может ввести информацию о доступной точке доступа к WIFI. Получив название и пароль ESP пытается подключится, и записывает данные о точке доступа во внутреннюю память EEPROM в случае успеха. Периодически ESP отправляет сигналы микрокотнтроллеру для выдачи корма или получения занчений с датчиков. ESP может получать сигналы от сервера при помощи mqtt, при помощи которых можно задать частоту кормелния рыб или запросить значения с датчиков. Всю информацию ESP отправляет на сервер при помощи API запросов.
Для установки проекта необходимо изменить переменные hash и serverIP в файле Config.h

## Демонстрация
https://disk.yandex.ru/i/8v_1miRzrAhWHQ

